<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Management</title>
</head>
<body>
    <h1>Recipe Management System</h1>

    <!-- Form to add a new recipe -->
    <h2>Add a Recipe</h2>
    <form id="addRecipeForm">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required><br><br>

        <label for="ingredients">Ingredients (comma separated):</label>
        <input type="text" id="ingredients" name="ingredients" required><br><br>

        <label for="instructions">Instructions:</label>
        <textarea id="instructions" name="instructions" required></textarea><br><br>

        <button type="submit">Add Recipe</button>
    </form>

    <hr>

    <!-- Display all recipes -->
    <h2>Recipes</h2>
    <ul id="recipesList"></ul>

    <script>
        // Fetch and display all recipes
        async function fetchRecipes() {
            const response = await fetch('/recipes');
            const recipes = await response.json();
            const recipesList = document.getElementById('recipesList');
            recipesList.innerHTML = '';
            recipes.forEach(recipe => {
                const li = document.createElement('li');
                li.textContent = `${recipe.title} - ${recipe.ingredients.join(', ')}`;

                // Add update button
                const updateButton = document.createElement('button');
                updateButton.textContent = 'Update';
                updateButton.addEventListener('click', () => {
                    const newTitle = prompt('Enter new title:', recipe.title);
                    const newIngredients = prompt('Enter new ingredients (comma separated):', recipe.ingredients.join(', '));
                    const newInstructions = prompt('Enter new instructions:', recipe.instructions);
                    updateRecipe(recipe._id, newTitle, newIngredients.split(','), newInstructions);
                });

                // Add delete button
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => {
                    if (confirm(`Are you sure you want to delete "${recipe.title}"?`)) {
                        deleteRecipe(recipe._id);
                    }
                });

                li.appendChild(updateButton);
                li.appendChild(deleteButton);
                recipesList.appendChild(li);
            });
        }

        // Add a new recipe
        document.getElementById('addRecipeForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const title = document.getElementById('title').value;
            const ingredients = document.getElementById('ingredients').value.split(',');
            const instructions = document.getElementById('instructions').value;

            const response = await fetch('/recipes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, ingredients, instructions })
            });

            if (response.ok) {
                alert('Recipe added successfully!');
                fetchRecipes(); // Refresh the list
            } else {
                alert('Failed to add recipe');
            }
        });

        // Update a recipe
        async function updateRecipe(id, title, ingredients, instructions) {
            const response = await fetch(`/recipes/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, ingredients, instructions }),
            });
            if (response.ok) {
                alert('Recipe updated successfully!');
                fetchRecipes();
            } else {
                alert('Failed to update recipe');
            }
        }

        // Delete a recipe
        async function deleteRecipe(id) {
            const response = await fetch(`/recipes/${id}`, { method: 'DELETE' });
            if (response.ok) {
                alert('Recipe deleted successfully!');
                fetchRecipes();
            } else {
                alert('Failed to delete recipe');
            }
        }

        // Fetch recipes on page load
        fetchRecipes();
    </script>
</body>
</html>
